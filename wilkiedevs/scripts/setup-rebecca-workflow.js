// Script para configurar y verificar el workflow completo de Rebecca
console.log('🚀 Configurador del Workflow de Rebecca\n');

console.log('📋 ESTADO ACTUAL DEL PROYECTO:');
console.log('✅ Código del chatbot implementado');
console.log('✅ Sistema RAG configurado');
console.log('✅ Base de conocimientos poblada');
console.log('✅ Integración con Supabase activa');
console.log('❌ Workflow de N8N inactivo (404 errors)');

console.log('\n🎯 WORKFLOW OBJETIVO:');
console.log('   ID: y8d3eOzMf5y9Uzbc');
console.log('   URL: https://n8n.wilkiedevs.com/workflow/y8d3eOzMf5y9Uzbc');
console.log('   Webhook: c4ce0742-8638-47b6-9507-a8bd7bb63896');

console.log('\n📝 PASOS PARA COMPLETAR LA CONFIGURACIÓN:\n');

console.log('1. 🌐 ACCEDER AL WORKFLOW:');
console.log('   - Abre: https://n8n.wilkiedevs.com/workflow/y8d3eOzMf5y9Uzbc');
console.log('   - Inicia sesión si es necesario');

console.log('\n2. ⚡ ACTIVAR EL WORKFLOW:');
console.log('   - Busca el toggle "Active" en la esquina superior derecha');
console.log('   - Haz clic para activarlo (debe ponerse verde/azul)');
console.log('   - Guarda el workflow (Ctrl+S o botón Save)');

console.log('\n3. 🔧 VERIFICAR CONFIGURACIÓN DEL WEBHOOK:');
console.log('   - Busca el nodo "Webhook" en el workflow');
console.log('   - Verifica que el Webhook ID sea: c4ce0742-8638-47b6-9507-a8bd7bb63896');
console.log('   - Asegúrate de que esté configurado como POST');
console.log('   - Verifica que acepte JSON');

console.log('\n4. 🔑 CONFIGURAR CREDENCIALES:');
console.log('   - Supabase URL: https://ziglshuhhtsthwedrous.supabase.co');
console.log('   - Supabase Key: (usar la anon key del proyecto)');
console.log('   - OpenAI/Gemini API Key: (configurar según el modelo usado)');

console.log('\n5. 🧪 PROBAR EL WORKFLOW:');
console.log('   - Usa el botón "Test Workflow" en N8N');
console.log('   - Envía un mensaje de prueba como:');
console.log('     {');
console.log('       "chatInput": "Hola Rebecca",');
console.log('       "sessionId": "test-123",');
console.log('       "userId": "test-user"');
console.log('     }');

console.log('\n6. ✅ VERIFICAR RESPUESTA:');
console.log('   - El workflow debe procesar el mensaje');
console.log('   - Debe generar una respuesta de Rebecca');
console.log('   - Debe guardar la conversación en Supabase');

console.log('\n🔄 ESTRUCTURA ESPERADA DEL WORKFLOW:\n');

console.log('📥 Webhook Trigger');
console.log('   ↓');
console.log('🧠 Procesamiento de IA (Intent Recognition)');
console.log('   ↓');
console.log('🔍 Búsqueda RAG (Knowledge Base)');
console.log('   ↓');
console.log('💬 Generación de Respuesta (GPT/Gemini)');
console.log('   ↓');
console.log('💾 Guardar en Supabase');
console.log('   ↓');
console.log('📤 Respuesta al Cliente');

console.log('\n🚨 PROBLEMAS COMUNES Y SOLUCIONES:\n');

console.log('❌ Error 404 en webhook:');
console.log('   → El workflow no está activo');
console.log('   → Activar el workflow en N8N');

console.log('\n❌ Error 500 en webhook:');
console.log('   → Credenciales incorrectas');
console.log('   → Verificar API keys de Supabase/OpenAI');

console.log('\n❌ Sin respuesta del workflow:');
console.log('   → Nodos mal conectados');
console.log('   → Verificar flujo de datos entre nodos');

console.log('\n❌ Error de base de datos:');
console.log('   → Tablas no existen');
console.log('   → Ejecutar scripts de población de datos');

console.log('\n🧪 COMANDOS DE PRUEBA:\n');

console.log('# Verificar estado del workflow');
console.log('node scripts/activate-n8n-workflow.js');

console.log('\n# Probar sistema completo');
console.log('node scripts/test-rebecca-complete-system.js');

console.log('\n# Poblar base de conocimientos');
console.log('node scripts/populate-knowledge-base.js');

console.log('\n# Probar sistema RAG');
console.log('node scripts/test-rag-system.js');

console.log('\n📊 MÉTRICAS DE ÉXITO:\n');

console.log('✅ Webhook responde (no 404)');
console.log('✅ Rebecca genera respuestas coherentes');
console.log('✅ Conversaciones se guardan en Supabase');
console.log('✅ Leads se capturan automáticamente');
console.log('✅ Sistema RAG encuentra información relevante');

console.log('\n🎉 UNA VEZ CONFIGURADO:\n');

console.log('1. El chatbot estará completamente funcional');
console.log('2. Rebecca responderá inteligentemente');
console.log('3. Se capturarán leads automáticamente');
console.log('4. Se generarán cotizaciones automáticas');
console.log('5. Todo se integrará con el sistema existente');

console.log('\n🔗 RECURSOS ÚTILES:\n');

console.log('- Workflow URL: https://n8n.wilkiedevs.com/workflow/y8d3eOzMf5y9Uzbc');
console.log('- Supabase Dashboard: https://supabase.com/dashboard');
console.log('- Documentación N8N: https://docs.n8n.io/');

console.log('\n💡 SIGUIENTE PASO INMEDIATO:');
console.log('   👉 Abre el workflow en N8N y actívalo');
console.log('   👉 Luego ejecuta: node scripts/test-rebecca-complete-system.js');

console.log('\n✨ ¡El sistema está casi listo! Solo falta activar el workflow.');